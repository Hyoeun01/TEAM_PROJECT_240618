<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout.html}">
<head>
    <meta charset="UTF-8">
    <title>리뷰 게시판</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link href="/css/review/list.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-latest.min.js"></script> <!-- jQuery 추가 -->
</head>

<div class="form-container" layout:fragment="content">
    <form enctype="multipart/form-data" method="post" th:action="@{/review}" th:object="${newReview}">
        <h1 class="mt-4">리뷰 게시판</h1>
        <hr>
        <a class="btn btn-outline-pink col-md-12" href="/review/register">리뷰쓰러가기</a>
        <br>
        <br>
        <!-- 리뷰 목록 -->
        <div class="row" id="reviewList">
            <div class="col-md-12" th:each="review : ${reviews}">
                <div class="card">
                    <div class="card-body">
                        <div class="review-content">
<!--                            모달창 사용-->
                            <img alt="리뷰 이미지" class="review-img" th:if="${review.RE_IMG}"
                                 th:src="@{'/image/'+${review.RE_IMG}}" onclick="showModal(this.src)">
                            <div class="review-text">
                                <h5 class="card-title" th:text="${review.RE_WRITER}">작성자</h5>
                                <p class="card-text" th:text="${review.RE_CONTENT}">내용</p>
                                <div class="review-meta">
                                    <span th:text="${review.RE_DATE}">작성일</span>
                                    <a class="card-link" th:href="@{/review/{reId}(reId=${review.RE_ID})}">상세보기</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="text-center">
            <button id="loadMore" class="btn btn-outline-pink col-md-12">더보기</button>
        </div><br>

<!--        이미지 모달창-->
        <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel"></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <img id="modalImage" src="" class="img-fluid" alt="리뷰 이미지">
                    </div>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            $(document).ready(function() {
                var size = 5; // 한 번에 보여줄 리뷰 개수

                // 초기에는 첫 번째 페이지의 리뷰만 보이도록 설정
                $('#reviewList .col-md-12').slice(0, size).show();

                // 숨겨진 리뷰를 초기화.
                $('#reviewList .col-md-12').slice(size).hide();

                // 버튼 클릭 시 콘솔에 메시지 출력
                $('#loadMore').on('click', function(e) {
                    e.preventDefault();
                    console.log("더보기 버튼 클릭됨!");

                    // 다음 페이지의 리뷰 보이기
                    $('#reviewList .col-md-12:hidden').slice(0, size).slideDown();

                    // 더 이상 보여줄 리뷰가 없으면 "더 보기" 버튼을 숨기기
                    if ($('#reviewList .col-md-12:hidden').length === 0) {
                        $('#loadMore').fadeOut('slow');
                    }
                });
            });

            // 이미지 모달창
            function showModal(src) {
                $('#modalImage').attr('src', src);
                var myModal = new bootstrap.Modal(document.getElementById('imageModal'));
                myModal.show();
            }

        </script>
    </form>
</div>
</html>
